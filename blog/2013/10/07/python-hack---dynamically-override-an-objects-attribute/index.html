<!DOCTYPE html5>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" prefix="og: http://ogp.me/ns#">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Python Hack - Dynamically override an object&#39;s attribute</title>

    
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="/css/clean-blog.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    
    
    

</head>

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@sdqali">
  <meta name="twitter:creator" content="@sdqali">
  <meta name="twitter:title" content="Python Hack - Dynamically override an object&#39;s attribute">
  <meta name="twitter:description" content="While working with Locust 1 recently, we ran into a situation where we had to dynamically override an attribute in a class in the Locust library so as to control what value it got assigned. After a lot of scratching our heads and reading the Python documentation, we came across the property function. We were able to use this to hack together a solution that ensures that every time an attribute is read, it returns the result of executing a method.">
  <meta name="twitter:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]">

  <meta property="og:title" content="Python Hack - Dynamically override an object&#39;s attribute" />
  <meta property="og:description" content="While working with Locust 1 recently, we ran into a situation where we had to dynamically override an attribute in a class in the Locust library so as to control what value it got assigned. After a lot of scratching our heads and reading the Python documentation, we came across the property function. We were able to use this to hack together a solution that ensures that every time an attribute is read, it returns the result of executing a method." itemprop="description"/>
  <meta property="og:url" content="http://sdqali.in/blog/2013/10/07/python-hack---dynamically-override-an-objects-attribute/" />
  <meta property="og:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]" />
  <body>

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Sadique Ali</a>
    </div>

    
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Home</a> </li>
        <li><a href="/blog/">Blog</a> </li>
        <li><a href="/about">About</a> </li>
        <li><a href="/index.xml">Atom Feed</a> </li>
        <li><a href="https://github.com/sdqali">GitHub</a> </li>
        <li><a href="https://twitter.com/sdqali">Twitter</a> </li>
        <li><a href="https://www.linkedin.com/in/sdqali">LinkedIn</a> </li>
      </ul>
    </div>
    
  </div>
  
</nav>




    
    
    <header class="intro-header">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="site-heading">
              <h1> Python Hack - Dynamically override an object&#39;s attribute</h1>
              <span class="meta">Mon, Oct 7, 2013</span>
            </div>
          </div>
        </div>
      </div>
    </header>


    
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            

<p>While working with Locust <sup class="footnote-ref" id="fnref:66b6e5fb09b6083bed97b4d7a2981cc2:1"><a rel="footnote" href="#fn:66b6e5fb09b6083bed97b4d7a2981cc2:1">1</a></sup> recently, we ran into a situation where we had to dynamically override an attribute in a class in the Locust library so as to control what value it got assigned. After a lot of scratching our heads and reading the Python documentation, we came across the <code>property</code> function. We were able to use this to hack together a solution that ensures that every time an attribute is read, it returns the result of executing a method.</p>

<p>The following example demonstrates a stripped down version of this hack.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">import</span> <span style="color: #00CCFF; font-weight: bold">random</span>

<span style="color: #006699; font-weight: bold">class</span> <span style="color: #00AA88; font-weight: bold">Foo</span>(<span style="color: #336666">object</span>):
    bar <span style="color: #555555">=</span> random<span style="color: #555555">.</span>random()

foo <span style="color: #555555">=</span> Foo()

<span style="color: #0099FF; font-style: italic"># Prints the value assigned when the Foo object is initialised.</span>
<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;Before override&quot;</span>)
<span style="color: #006699; font-weight: bold">print</span>(foo<span style="color: #555555">.</span>bar)
<span style="color: #006699; font-weight: bold">print</span>(foo<span style="color: #555555">.</span>bar)

<span style="color: #0099FF; font-style: italic"># Override</span>
Foo<span style="color: #555555">.</span>bar <span style="color: #555555">=</span> <span style="color: #336666">property</span>(<span style="color: #006699; font-weight: bold">lambda</span> <span style="color: #336666">self</span>: random<span style="color: #555555">.</span>random())

<span style="color: #006699; font-weight: bold">print</span>(<span style="color: #CC3300">&quot;After override&quot;</span>)
<span style="color: #006699; font-weight: bold">print</span>(foo<span style="color: #555555">.</span>bar)
<span style="color: #006699; font-weight: bold">print</span>(foo<span style="color: #555555">.</span>bar)
</pre></div>

<p>This snippet when executed will output the following:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>Before override
0.0373028550804
0.0373028550804
After override
0.603160033663
0.501455108419
</pre></div>

<p>It can be seen that before introducing the override, the value of the <code>bar</code> attribute is set when the class is initialised and as expected, it does not change how many ever times the attribute is read. However, after the override, the attribute is assigned a new value every time it is read.</p>

<h2 id="how-does-this-work:66b6e5fb09b6083bed97b4d7a2981cc2">How does this work?</h2>

<p>The <code>property()</code> <sup class="footnote-ref" id="fnref:66b6e5fb09b6083bed97b4d7a2981cc2:2"><a rel="footnote" href="#fn:66b6e5fb09b6083bed97b4d7a2981cc2:2">2</a></sup> function returns an attribute for any class. It allows the creation of Ruby&rsquo;s <code>attr_accessor</code> <sup class="footnote-ref" id="fnref:66b6e5fb09b6083bed97b4d7a2981cc2:3"><a rel="footnote" href="#fn:66b6e5fb09b6083bed97b4d7a2981cc2:3">3</a></sup> style attributes on classes so that one can write <code>instance.attrib</code> to read an attribute value and <code>instance.attrib=</code> to set an attribute value. What line <code>14</code> in the snippet does is to re-define the <code>bar</code> attribute to be a property whose <code>getter</code> is a <code>lambda</code>. Every time the <code>bar</code> attribute is read, the <code>lambda</code> gets executed.</p>

<p>A more comprehensive example of this can be found in my <a href="https://github.com/sdqali/python_dojo/blob/master/dynamic_override/dynamic_override.py">Python dojo repository</a> on GitHub.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:66b6e5fb09b6083bed97b4d7a2981cc2:1"><a href="http://locust.io/">Locust</a> - a modern load testing framework.
 <a class="footnote-return" href="#fnref:66b6e5fb09b6083bed97b4d7a2981cc2:1"><sup>[return]</sup></a></li>
<li id="fn:66b6e5fb09b6083bed97b4d7a2981cc2:2">Python&rsquo;s built-in functions - <a href="http://docs.python.org/2/library/functions.html#property">property</a>.
 <a class="footnote-return" href="#fnref:66b6e5fb09b6083bed97b4d7a2981cc2:2"><sup>[return]</sup></a></li>
<li id="fn:66b6e5fb09b6083bed97b4d7a2981cc2:3">Ruby&rsquo;s <a href="http://www.ruby-doc.org/core-1.9.3/Module.html#method-i-attr_accessor"><code>attr_accessor</code> method</a>.
 <a class="footnote-return" href="#fnref:66b6e5fb09b6083bed97b4d7a2981cc2:3"><sup>[return]</sup></a></li>
</ol>
</div>

          </div>
        </div>
      </div>
    </article>

    <hr>

    
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          <li>
            <a href="https://twitter.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://github.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="/index.xml">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        </ul>
        <p class="copyright text-muted">&copy; All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


<script src="/js/jquery.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script src="/js/clean-blog.min.js"></script>

  </body>
</html>
