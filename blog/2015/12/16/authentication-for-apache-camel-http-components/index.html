<!DOCTYPE html5>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" prefix="og: http://ogp.me/ns#">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A blog about the Code I write and the Technologies I use. And other things that interest me.">
    <meta content="Programming, Software Development, Java Development, Coding" name="keywords">
    <meta name="author" content="Sadique Ali">

    
    
      
    
    

    <title>Authentication for Apache Camel HTTP components - Sadique Ali</title>

    
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="/css/clean-blog.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    
    <link href="/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='/css/fonts.css' rel='stylesheet' type='text/css'>

    
    
    

</head>

  <meta name="description" content="My team at work has been lately working on a data transformer that pushes information from an external system in to platform. For historical reasons the information is passed to us in the form of flat files. We have been working on a data transformer that reads information from the file and posts it into an HTTP end point.
Apache Camel 1 makes a natural choice as the base for implementing such a data transformer. The presence of ready to use components that can read files and post information to HTTP end points and the availability of a nice D.S.L. 2 makes implementation easy and straightforward. One of the things we had to spend time figuring out was how to ensure that we authenticate correctly against our target HTTP end point. This blog post takes a look at various methods we explored." />
  <meta content="" name="keywords">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@sdqali">
  <meta name="twitter:creator" content="@sdqali">
  <meta name="twitter:title" content="Authentication for Apache Camel HTTP components">
  <meta name="twitter:description" content="My team at work has been lately working on a data transformer that pushes information from an external system in to platform. For historical reasons the information is passed to us in the form of flat files. We have been working on a data transformer that reads information from the file and posts it into an HTTP end point.
Apache Camel 1 makes a natural choice as the base for implementing such a data transformer. The presence of ready to use components that can read files and post information to HTTP end points and the availability of a nice D.S.L. 2 makes implementation easy and straightforward. One of the things we had to spend time figuring out was how to ensure that we authenticate correctly against our target HTTP end point. This blog post takes a look at various methods we explored.">
  <meta name="twitter:image" content="http://sdqali.in/images/apache-camel.png">

  <meta property="og:title" content="Authentication for Apache Camel HTTP components" />
  <meta property="og:description" content="My team at work has been lately working on a data transformer that pushes information from an external system in to platform. For historical reasons the information is passed to us in the form of flat files. We have been working on a data transformer that reads information from the file and posts it into an HTTP end point.
Apache Camel 1 makes a natural choice as the base for implementing such a data transformer. The presence of ready to use components that can read files and post information to HTTP end points and the availability of a nice D.S.L. 2 makes implementation easy and straightforward. One of the things we had to spend time figuring out was how to ensure that we authenticate correctly against our target HTTP end point. This blog post takes a look at various methods we explored." itemprop="description"/>
  <meta property="og:url" content="http://sdqali.in/blog/2015/12/16/authentication-for-apache-camel-http-components/" />
  <meta property="og:image" content="http://sdqali.in/images/apache-camel.png" />
  <body>

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Sadique Ali</a>
    </div>

    
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Home</a> </li>
        <li><a href="/blog/">Blog</a> </li>
        <li><a href="/about">About</a> </li>
        <li><a href="/index.xml">Atom Feed</a> </li>
        <li><a href="https://github.com/sdqali">GitHub</a> </li>
        <li><a href="https://twitter.com/sdqali">Twitter</a> </li>
        <li><a href="https://www.linkedin.com/in/sdqali">LinkedIn</a> </li>
      </ul>
    </div>
    
  </div>
  
</nav>




    
    
    <header class="intro-header">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="site-heading">
              <h1> Authentication for Apache Camel HTTP components</h1>
              <span class="meta">Wed, Dec 16, 2015</span>
            </div>
          </div>
        </div>
      </div>
    </header>


    
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <p>My team at work has been lately working on a data transformer that pushes information from an external system in to platform. For historical reasons the information is passed to us in the form of flat files. We have been working on a data transformer that reads information from the file and posts it into an HTTP end point.
Apache Camel <sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup> makes a natural choice as the base for implementing such a data transformer. The presence of ready to use components that can read files and post information to HTTP end points and the availability of a nice D.S.L. <sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup> makes implementation easy and straightforward. One of the things we had to spend time figuring out was how to ensure that we authenticate correctly against our target HTTP end point. This blog post takes a look at various methods we explored.</p>

<p>
Camel&rsquo;s HTTP component allows http resources to be added as Camel end points. These end points can be consuming information from routes or producing information which are then passed on to routes. For example, the following route takes information from the <code>direct:start</code> end point, tokenizes it into lines and sends each line into an HTTP url.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">class</span> <span style="color: #00AA88; font-weight: bold">FileToApiRoute</span> <span style="color: #006699; font-weight: bold">extends</span> RouteBuilder <span style="color: #555555">{</span>

    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">static</span> <span style="color: #006699; font-weight: bold">final</span> String UTF_8 <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;UTF-8&quot;</span><span style="color: #555555">;</span>
    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">static</span> <span style="color: #006699; font-weight: bold">final</span> String CONTENT_TYPE <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;Content-Type&quot;</span><span style="color: #555555">;</span>
    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">static</span> <span style="color: #006699; font-weight: bold">final</span> String APPLICATION_JSON <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;application/json&quot;</span><span style="color: #555555">;</span>
    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">static</span> <span style="color: #006699; font-weight: bold">final</span> String TARGET <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;http://localhost:8080/ingest&quot;</span><span style="color: #555555">;</span>

    <span style="color: #9999FF">@Override</span>
    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #007788; font-weight: bold">void</span> <span style="color: #CC00FF">configure</span><span style="color: #555555">()</span> <span style="color: #006699; font-weight: bold">throws</span> Exception <span style="color: #555555">{</span>
        from<span style="color: #555555">(</span><span style="color: #CC3300">&quot;direct:start&quot;</span><span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">marshal</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">string</span><span style="color: #555555">(</span>UTF_8<span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">split</span><span style="color: #555555">(</span>body<span style="color: #555555">().</span><span style="color: #330099">tokenize</span><span style="color: #555555">())</span>
                <span style="color: #555555">.</span><span style="color: #330099">streaming</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">setHeader</span><span style="color: #555555">(</span>CONTENT_TYPE<span style="color: #555555">,</span> simple<span style="color: #555555">(</span>APPLICATION_JSON<span style="color: #555555">))</span>
                <span style="color: #555555">.</span><span style="color: #330099">to</span><span style="color: #555555">(</span>TARGET<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
<span style="color: #555555">}</span>
</pre></div>

<p>Once this route has been registered, it can be used to send data by placing information on the <code>direct:start</code> end point. The following service does it by passing the contents of a file to a <code>ProducerTemplate</code>:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">class</span> <span style="color: #00AA88; font-weight: bold">DataStreamService</span> <span style="color: #555555">{</span>

    <span style="color: #006699; font-weight: bold">private</span> <span style="color: #006699; font-weight: bold">final</span> ProducerTemplate producerTemplate<span style="color: #555555">;</span>

    <span style="color: #9999FF">@Autowired</span>
    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #CC00FF">DataStreamService</span><span style="color: #555555">(</span>ProducerTemplate producerTemplate<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">this</span><span style="color: #555555">.</span><span style="color: #330099">producerTemplate</span> <span style="color: #555555">=</span> producerTemplate<span style="color: #555555">;</span>
    <span style="color: #555555">}</span>

    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #007788; font-weight: bold">void</span> <span style="color: #CC00FF">stream</span><span style="color: #555555">()</span> <span style="color: #555555">{</span>
        producerTemplate<span style="color: #555555">.</span><span style="color: #330099">sendBody</span><span style="color: #555555">(</span><span style="color: #CC3300">&quot;direct:start&quot;</span><span style="color: #555555">,</span>
                ExchangePattern<span style="color: #555555">.</span><span style="color: #330099">InOnly</span><span style="color: #555555">,</span>
                <span style="color: #006699; font-weight: bold">new</span> File<span style="color: #555555">(</span><span style="color: #CC3300">&quot;src/main/resources/yelp.business.json&quot;</span><span style="color: #555555">));</span>
    <span style="color: #555555">}</span>
<span style="color: #555555">}</span>
</pre></div>

<p>Our challenge is to ensure that this continue to work when the HTTP end point in question requires authentication. For the purposes of this blog post, we will be restricting our discussion to Basic Authentication. There are three ways to do this authentication–through Camel authentication query parameters, through the use of the <code>Authorization</code> header and by overriding the <code>HttpConfiguration</code> in the current Camel context.</p>

<h3 id="camel-authentication-query-parameters">Camel authentication query parameters</h3>

<p>Camel allows consumers to specify authentication parameters in the http end point. For example, three parameters required for Basic Authentication are <code>authMethod</code>, <code>authUsername</code> and <code>authPassword</code>. The route rewritten with these parameters will be as follows:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">static</span> <span style="color: #006699; font-weight: bold">final</span> String TARGET_WITH_AUTH <span style="color: #555555">=</span> <span style="color: #CC3300">&quot;http://localhost:8080/ingest&quot;</span> <span style="color: #555555">+</span>
            <span style="color: #CC3300">&quot;?authMethod=Basic&amp;authUsername=test&amp;authPassword=test&quot;</span><span style="color: #555555">;</span>

    <span style="color: #9999FF">@Override</span>
    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #007788; font-weight: bold">void</span> <span style="color: #CC00FF">configure</span><span style="color: #555555">()</span> <span style="color: #006699; font-weight: bold">throws</span> Exception <span style="color: #555555">{</span>
        from<span style="color: #555555">(</span><span style="color: #CC3300">&quot;direct:start&quot;</span><span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">marshal</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">string</span><span style="color: #555555">(</span>UTF_8<span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">split</span><span style="color: #555555">(</span>body<span style="color: #555555">().</span><span style="color: #330099">tokenize</span><span style="color: #555555">())</span>
                <span style="color: #555555">.</span><span style="color: #330099">streaming</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">setHeader</span><span style="color: #555555">(</span>CONTENT_TYPE<span style="color: #555555">,</span> simple<span style="color: #555555">(</span>APPLICATION_JSON<span style="color: #555555">))</span>
                <span style="color: #555555">.</span><span style="color: #330099">to</span><span style="color: #555555">(</span>TARGET_WITH_AUTH<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
</pre></div>

<p>It is odd to be adding authentication parameters to a URL, but here the URL has multiple purposes–this is a URL to which information is going to be sent to, it also represents a logical end point. These three parameters (and other authentication parameters) get stripped from the HTTP URL before Camel makes the HTTP request. <sup class="footnote-ref" id="fnref:3"><a rel="footnote" href="#fn:3">3</a></sup> This still will cause issues in odd cases where the HTTP A.P.I. you are integrating with expects these parameters to be sent.</p>

<h3 id="setting-authorization-headers">Setting Authorization headers</h3>

<p>Camel allows the addition of headers to messages that it processes and if the message ultimately gets routed to a Camel HTTP end point, these headers get converted to HTTP headers. This allows us to use authentication by setting the <code>Authorization</code> header. This example demonstrates this:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>    <span style="color: #006699; font-weight: bold">public</span> <span style="color: #007788; font-weight: bold">void</span> <span style="color: #CC00FF">configure</span><span style="color: #555555">()</span> <span style="color: #006699; font-weight: bold">throws</span> Exception <span style="color: #555555">{</span>
        from<span style="color: #555555">(</span><span style="color: #CC3300">&quot;direct:start&quot;</span><span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">marshal</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">string</span><span style="color: #555555">(</span>UTF_8<span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">split</span><span style="color: #555555">(</span>body<span style="color: #555555">().</span><span style="color: #330099">tokenize</span><span style="color: #555555">())</span>
                <span style="color: #555555">.</span><span style="color: #330099">streaming</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">setHeader</span><span style="color: #555555">(</span>CONTENT_TYPE<span style="color: #555555">,</span> simple<span style="color: #555555">(</span>APPLICATION_JSON<span style="color: #555555">))</span>
                <span style="color: #555555">.</span><span style="color: #330099">setHeader</span><span style="color: #555555">(</span><span style="color: #CC3300">&quot;Authorization&quot;</span><span style="color: #555555">,</span> simple<span style="color: #555555">(</span><span style="color: #CC3300">&quot;Basic dGVzdDp0ZXN0&quot;</span><span style="color: #555555">))</span>
                <span style="color: #555555">.</span><span style="color: #330099">to</span><span style="color: #555555">(</span>TARGET<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
</pre></div>

<h3 id="overriding-httpconfiguration">Overriding HttpConfiguration</h3>

<p>Camel provides a mechanism to override it‘s Context‘s configuration before the context gets created. In the following example, we get a reference to the <code>HttpComponent</code> and set a new <code>HttpConfiguration</code> with the right authentication. This allows us to separate the authentication configurations from the route definitions. However, if your Camel context is responsible for talking to different HTTP end points with different authentication mechanisms or parameters, this will not solve the issue.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>    <span style="color: #9999FF">@Bean</span>
    CamelContextConfiguration <span style="color: #CC00FF">contextConfiguration</span><span style="color: #555555">()</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> camelContext <span style="color: #555555">-&gt;</span> <span style="color: #555555">{</span>
            HttpComponent http <span style="color: #555555">=</span> <span style="color: #555555">(</span>HttpComponent<span style="color: #555555">)</span> camelContext<span style="color: #555555">.</span><span style="color: #330099">getComponent</span><span style="color: #555555">(</span><span style="color: #CC3300">&quot;http&quot;</span><span style="color: #555555">);</span>
            http<span style="color: #555555">.</span><span style="color: #330099">setHttpConfiguration</span><span style="color: #555555">(</span>httpConfiguration<span style="color: #555555">());</span>
        <span style="color: #555555">};</span>
    <span style="color: #555555">}</span>

    <span style="color: #006699; font-weight: bold">private</span> HttpConfiguration <span style="color: #CC00FF">httpConfiguration</span><span style="color: #555555">()</span> <span style="color: #555555">{</span>
        HttpConfiguration httpConfiguration <span style="color: #555555">=</span> <span style="color: #006699; font-weight: bold">new</span> HttpConfiguration<span style="color: #555555">();</span>
        httpConfiguration<span style="color: #555555">.</span><span style="color: #330099">setAuthMethod</span><span style="color: #555555">(</span>authScheme<span style="color: #555555">);</span>
        httpConfiguration<span style="color: #555555">.</span><span style="color: #330099">setAuthUsername</span><span style="color: #555555">(</span>authUsername<span style="color: #555555">);</span>
        httpConfiguration<span style="color: #555555">.</span><span style="color: #330099">setAuthPassword</span><span style="color: #555555">(</span>authPassword<span style="color: #555555">);</span>
        <span style="color: #006699; font-weight: bold">return</span> httpConfiguration<span style="color: #555555">;</span>
    <span style="color: #555555">}</span>
</pre></div>

<p>In the end, the method you choose will depend on the unique constraints of the systems you are integrating with.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"><a href="https://camel.apache.org/">Apache Camel</a> is a Java integration framework.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">Camel&rsquo;s Domain Specific Language in Java allows integration routes to be defined as fluent specifications.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3">Stripping of these parameters is done inside <code>org.apache.camel.component.http.HttpComponent</code>‘s <code>createHttpClientConfigurer</code> <a href="https://github.com/apache/camel/blob/f7f0b18f6924fe0b01f32a25ed1e38e29b1bf8e5/components/camel-http/src/main/java/org/apache/camel/component/http/HttpComponent.java#L66">method</a>.
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
</ol>
</div>
            <p class="comments">
  If you have questions or comments about this blog post, you can get in touch with me on Twitter <a href="https://twitter.com/sdqali">@sdqali</a>.
</p>

          </div>
        </div>
      </div>
    </article>

    <hr>

    
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          <li>
            <a href="https://twitter.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://github.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="/index.xml">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        </ul>
        <p class="copyright text-muted">&copy; All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


<script src="/js/jquery.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script src="/js/clean-blog.min.js"></script>

<script src="http://sdqali.in/js/keen.min.3.3.0.js" type="text/javascript"></script>
<script src="http://sdqali.in/js/parseuri.js" type="text/javascript"></script>
<script src="http://sdqali.in/js/ua-parser.min.js" type="text/javascript
"></script>
 <script src="http://sdqali.in/js/Math.uuid.js" type="text/javascript"></script>
<script src="http://sdqali.in/js/analytics.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86967633-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>
</html>
