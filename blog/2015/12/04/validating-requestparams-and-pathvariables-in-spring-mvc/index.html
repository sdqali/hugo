<!DOCTYPE html5>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" prefix="og: http://ogp.me/ns#">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Validating RequestParams and PathVariables in Spring MVC</title>

    
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="/css/clean-blog.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    
    
    

</head>

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@sdqali">
  <meta name="twitter:creator" content="@sdqali">
  <meta name="twitter:title" content="Validating RequestParams and PathVariables in Spring MVC">
  <meta name="twitter:description" content="Spring MVC provides a convenient way to validate inputs to API end points through the use of JSR-303 annotations. While this mechanism works great for end points that consume a RequestBody (as is the case with most POST and PUT requests), it is not easy to achieve the same effect for end points that consume primitives in the form of path variables or request parameters (as is the case with most GET requests).
">
  <meta name="twitter:image" content="http://sdqali.in/images/spring-by-pivotal.png">

  <meta property="og:title" content="Validating RequestParams and PathVariables in Spring MVC" />
  <meta property="og:description" content="Spring MVC provides a convenient way to validate inputs to API end points through the use of JSR-303 annotations. While this mechanism works great for end points that consume a RequestBody (as is the case with most POST and PUT requests), it is not easy to achieve the same effect for end points that consume primitives in the form of path variables or request parameters (as is the case with most GET requests).
" itemprop="description"/>
  <meta property="og:url" content="http://sdqali.in/blog/2015/12/04/validating-requestparams-and-pathvariables-in-spring-mvc/" />
  <meta property="og:image" content="http://sdqali.in/images/spring-by-pivotal.png" />
  <body>

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Sadique Ali</a>
    </div>

    
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Home</a> </li>
        <li><a href="/blog/">Blog</a> </li>
        <li><a href="/about">About</a> </li>
        <li><a href="https://github.com/sdqali">GitHub</a> </li>
        <li><a href="https://twitter.com/sdqali">Twitter</a> </li>
        <li><a href="https://www.linkedin.com/in/sdqali">LinkedIn</a> </li>
      </ul>
    </div>
    
  </div>
  
</nav>




    
    
    <header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="site-heading">
              <h1> Validating RequestParams and PathVariables in Spring MVC</h1>
              <span class="meta">Fri, Dec 4, 2015</span>
            </div>
          </div>
        </div>
      </div>
    </header>


    
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <p>Spring MVC provides a convenient way to validate inputs to API end points through the use of <code>JSR-303</code> annotations. While this mechanism works great for end points that consume a <code>RequestBody</code> (as is the case with most <code>POST</code> and <code>PUT</code> requests), it is not easy to achieve the same effect for end points that consume primitives in the form of path variables or request parameters (as is the case with most <code>GET</code> requests).</p>

<p>Let&rsquo;s take a look at how to validate RequestBody inputs using JSR-303.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>    <span style="color: #9999FF">@RequestMapping</span><span style="color: #555555">(</span>method <span style="color: #555555">=</span> RequestMethod<span style="color: #555555">.</span><span style="color: #330099">POST</span><span style="color: #555555">,</span>
            consumes <span style="color: #555555">=</span> MediaType<span style="color: #555555">.</span><span style="color: #330099">APPLICATION_JSON_VALUE</span><span style="color: #555555">,</span>
            produces <span style="color: #555555">=</span> MediaType<span style="color: #555555">.</span><span style="color: #330099">APPLICATION_JSON_VALUE</span>
    <span style="color: #555555">)</span>
    <span style="color: #9999FF">@ResponseStatus</span><span style="color: #555555">(</span>HttpStatus<span style="color: #555555">.</span><span style="color: #330099">OK</span><span style="color: #555555">)</span>
    <span style="color: #006699; font-weight: bold">public</span> Map <span style="color: #CC00FF">register</span><span style="color: #555555">(</span><span style="color: #9999FF">@RequestBody</span> <span style="color: #9999FF">@Valid</span> EmailRequest emailRequest<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> registrationService<span style="color: #555555">.</span><span style="color: #330099">register</span><span style="color: #555555">(</span>emailRequest<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
</pre></div>

<p>The value object <code>EmailRequest</code> is annotated with the appropriate constraint annotations.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">class</span> <span style="color: #00AA88; font-weight: bold">EmailRequest</span> <span style="color: #555555">{</span>
    <span style="color: #9999FF">@Email</span>
    <span style="color: #006699; font-weight: bold">public</span> String email<span style="color: #555555">;</span>

    <span style="color: #006699; font-weight: bold">private</span> <span style="color: #CC00FF">EmailRequest</span><span style="color: #555555">()</span> <span style="color: #555555">{</span>
    <span style="color: #555555">}</span>

    <span style="color: #006699; font-weight: bold">public</span> String <span style="color: #CC00FF">getEmail</span><span style="color: #555555">()</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> email<span style="color: #555555">;</span>
    <span style="color: #555555">}</span>
<span style="color: #555555">}</span>
</pre></div>

<p>If we were to attempt a similar approach for a <code>GET</code> end point that accepts a <code>RequestParam</code>, the validation would simply not happen.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>    <span style="color: #9999FF">@RequestMapping</span><span style="color: #555555">(</span>method <span style="color: #555555">=</span> RequestMethod<span style="color: #555555">.</span><span style="color: #330099">GET</span><span style="color: #555555">,</span>
            consumes <span style="color: #555555">=</span> MediaType<span style="color: #555555">.</span><span style="color: #330099">APPLICATION_JSON_VALUE</span><span style="color: #555555">,</span>
            produces <span style="color: #555555">=</span> MediaType<span style="color: #555555">.</span><span style="color: #330099">APPLICATION_JSON_VALUE</span>
    <span style="color: #555555">)</span>
    <span style="color: #9999FF">@ResponseStatus</span><span style="color: #555555">(</span>HttpStatus<span style="color: #555555">.</span><span style="color: #330099">OK</span><span style="color: #555555">)</span>
    <span style="color: #006699; font-weight: bold">public</span> Map <span style="color: #CC00FF">search</span><span style="color: #555555">(</span><span style="color: #9999FF">@Email</span>
                   <span style="color: #9999FF">@Valid</span>
                   <span style="color: #9999FF">@RequestParam</span><span style="color: #555555">(</span><span style="color: #CC3300">&quot;email&quot;</span><span style="color: #555555">)</span>
                   String email<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> emailMessage<span style="color: #555555">(</span>email<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
</pre></div>

<p>This is where Spring&rsquo;s <code>@Validated</code> annotation is useful. With <code>@Validated</code>, we can validate request parameters and path variables.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #9999FF">@RestController</span>
<span style="color: #9999FF">@Validated</span>
<span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">class</span> <span style="color: #00AA88; font-weight: bold">RegistrationController</span> <span style="color: #555555">{</span>
    <span style="color: #9999FF">@RequestMapping</span><span style="color: #555555">(</span>method <span style="color: #555555">=</span> RequestMethod<span style="color: #555555">.</span><span style="color: #330099">GET</span><span style="color: #555555">,</span>
            consumes <span style="color: #555555">=</span> MediaType<span style="color: #555555">.</span><span style="color: #330099">APPLICATION_JSON_VALUE</span><span style="color: #555555">,</span>
            produces <span style="color: #555555">=</span> MediaType<span style="color: #555555">.</span><span style="color: #330099">APPLICATION_JSON_VALUE</span>
    <span style="color: #555555">)</span>
    <span style="color: #9999FF">@ResponseStatus</span><span style="color: #555555">(</span>HttpStatus<span style="color: #555555">.</span><span style="color: #330099">OK</span><span style="color: #555555">)</span>
    <span style="color: #006699; font-weight: bold">public</span> Map <span style="color: #CC00FF">search</span><span style="color: #555555">(</span><span style="color: #9999FF">@Email</span>
                   <span style="color: #9999FF">@RequestParam</span><span style="color: #555555">(</span><span style="color: #CC3300">&quot;email&quot;</span><span style="color: #555555">)</span>
                   String email<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> emailMessage<span style="color: #555555">(</span>email<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
<span style="color: #555555">}</span>
</pre></div>

<p>An important thing to note here is that using <code>@Valid</code> annotation results in <code>MethodArgumentNotValidException</code> being thrown when validation fails, but <code>@Validated</code> results in <code>ConstraintViolationException</code> being thrown. Since these exceptions have different ways of abstracting the error messages associated with validation, it is important to have different error handlers for both of these. An example pattern using <code>ExceptionHandler</code> will be as follows:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #9999FF">@ControllerAdvice</span>
<span style="color: #9999FF">@Component</span>
<span style="color: #006699; font-weight: bold">public</span> <span style="color: #006699; font-weight: bold">class</span> <span style="color: #00AA88; font-weight: bold">GlobalExceptionHandler</span> <span style="color: #555555">{</span>
    <span style="color: #9999FF">@ExceptionHandler</span>
    <span style="color: #9999FF">@ResponseBody</span>
    <span style="color: #9999FF">@ResponseStatus</span><span style="color: #555555">(</span>HttpStatus<span style="color: #555555">.</span><span style="color: #330099">BAD_REQUEST</span><span style="color: #555555">)</span>
    <span style="color: #006699; font-weight: bold">public</span> Map <span style="color: #CC00FF">handle</span><span style="color: #555555">(</span>MethodArgumentNotValidException exception<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> error<span style="color: #555555">(</span>exception<span style="color: #555555">.</span><span style="color: #330099">getBindingResult</span><span style="color: #555555">().</span><span style="color: #330099">getFieldErrors</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">stream</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">map</span><span style="color: #555555">(</span>FieldError<span style="color: #555555">::</span>getDefaultMessage<span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">collect</span><span style="color: #555555">(</span>Collectors<span style="color: #555555">.</span><span style="color: #330099">toList</span><span style="color: #555555">()));</span>
    <span style="color: #555555">}</span>


    <span style="color: #9999FF">@ExceptionHandler</span>
    <span style="color: #9999FF">@ResponseBody</span>
    <span style="color: #9999FF">@ResponseStatus</span><span style="color: #555555">(</span>HttpStatus<span style="color: #555555">.</span><span style="color: #330099">BAD_REQUEST</span><span style="color: #555555">)</span>
    <span style="color: #006699; font-weight: bold">public</span> Map <span style="color: #CC00FF">handle</span><span style="color: #555555">(</span>ConstraintViolationException exception<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> error<span style="color: #555555">(</span>exception<span style="color: #555555">.</span><span style="color: #330099">getConstraintViolations</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">stream</span><span style="color: #555555">()</span>
                <span style="color: #555555">.</span><span style="color: #330099">map</span><span style="color: #555555">(</span>ConstraintViolation<span style="color: #555555">::</span>getMessage<span style="color: #555555">)</span>
                <span style="color: #555555">.</span><span style="color: #330099">collect</span><span style="color: #555555">(</span>Collectors<span style="color: #555555">.</span><span style="color: #330099">toList</span><span style="color: #555555">()));</span>
    <span style="color: #555555">}</span>

    <span style="color: #006699; font-weight: bold">private</span> Map <span style="color: #CC00FF">error</span><span style="color: #555555">(</span>Object message<span style="color: #555555">)</span> <span style="color: #555555">{</span>
        <span style="color: #006699; font-weight: bold">return</span> Collections<span style="color: #555555">.</span><span style="color: #330099">singletonMap</span><span style="color: #555555">(</span><span style="color: #CC3300">&quot;error&quot;</span><span style="color: #555555">,</span> message<span style="color: #555555">);</span>
    <span style="color: #555555">}</span>
<span style="color: #555555">}</span>
</pre></div>

          </div>
        </div>
      </div>
    </article>

    <hr>

    
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          <li>
            <a href="https://twitter.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://github.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        </ul>
        <p class="copyright text-muted">&copy; All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


<script src="/js/jquery.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script src="/js/clean-blog.min.js"></script>

  </body>
</html>
