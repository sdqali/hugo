<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" prefix="og: http://ogp.me/ns#">
  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title> Autorun.py - Execute stuff on file change &middot; Sadique Ali </title>

    
    <link rel="stylesheet" href="http://sdqali.in/css/poole.css">
    <link rel="stylesheet" href="http://sdqali.in/css/syntax.css">
    <link rel="stylesheet" href="http://sdqali.in/css/hyde.css">
    <link rel="stylesheet" href="http://sdqali.in/css/default.min.css">
    <link rel="stylesheet" href="http://sdqali.in/css/custom.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

    
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    
    <link href="" rel="alternate" type="application/rss+xml" title="Sadique Ali" />

    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
  </head>


<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@sdqali">
<meta name="twitter:creator" content="@sdqali">
<meta name="twitter:title" content="Autorun.py - Execute stuff on file change">
<meta name="twitter:description" content="I really liked ZenTest&rsquo;s Autospec in action. Recently, when I was trying to write some Python stuff, I thought it would be nice if I would have a tool that would just run the unit tests, so that I don&rsquo;t have to switch between console windows. Better still, I could run it from inside my Emacs. Clearly, monitoring files for changes, shouldn&rsquo;t be big deal. I decided to write the tool myself in Python.">
<meta name="twitter:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]">

g<meta property="og:title" content="Autorun.py - Execute stuff on file change" />
<meta property="og:description" content="I really liked ZenTest&rsquo;s Autospec in action. Recently, when I was trying to write some Python stuff, I thought it would be nice if I would have a tool that would just run the unit tests, so that I don&rsquo;t have to switch between console windows. Better still, I could run it from inside my Emacs. Clearly, monitoring files for changes, shouldn&rsquo;t be big deal. I decided to write the tool myself in Python." itemprop="description"/>
<meta property="og:url" content="http://sdqali.in/blog/2010/01/09/autorun.py---execute-stuff-on-file-change/" />
<meta property="og:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]" />
<meta itemprop="datePublished" content="2010-01-09 00:00:00 &#43;0000 UTC"/>
<meta itemprop="dateModified" content="2010-01-09 00:00:00 &#43;0000 UTC"/>
<body class="theme-base-0b">

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
	<a href="/">Sadique Ali</a>
      </h1>
      <p class="lead">
       A blog about the Code I write and the Technologies I use. And other things that interest me. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      <li><a href="/blog/">Blog</a> </li>
      <li><a href="/about">About</a> </li>
      <li><a href="https://github.com/sdqali">GitHub</a> </li>
      <li><a href="https://twitter.com/sdqali">Twitter</a> </li>
      <li><a href="https://www.linkedin.com/in/sdqali">LinkedIn</a> </li>
      
        <li><a href="/blog/2015/12/14/thoughts-on-open-graph-tags/"> Thoughts on Open Graph tags </a></li>
      
    </ul>

    <p>&copy; 2015. All rights reserved. </p>
  </div>
</div>


<div class="content container" itemscope itemtype="http://schema.org/BlogPosting">
<meta itemscope itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" itemid="http://sdqali.in/blog/2010/01/09/autorun.py---execute-stuff-on-file-change/"/>

<div class="post">
  <h1 itemprop="headline">Autorun.py - Execute stuff on file change</h1>
  <div class="author" itemprop="author" itemscope itemtype="https://schema.org/Person">
    By <span itemprop="name">Sadique Ali</span>
  </div>
  <span class="post-date">Sat, Jan 9, 2010</span>
      <p>I really liked ZenTest&rsquo;s Autospec in action. Recently, when I was trying to write some Python stuff, I thought it would be nice if I would have a tool that would just run the unit tests, so that I don&rsquo;t have to switch between console windows. Better still, I could run it from inside my Emacs.</p>

<p>Clearly, monitoring files for changes, shouldn&rsquo;t be big deal. I decided to write the tool myself in Python. the prime intension was to help myself learn Python. Although that didn&rsquo;t quite workout, I managed to come up with a quick and dirty hack to do it. It uses <code>pyinotify</code>, which is a Python module for monitoring filesystem changes. Since <code>pyinotify</code> depends on the Linux kernel, this would work only on Linux boxes.</p>

<p>I named it <code>autorun.py</code>. If you want to run some task, depending on file changes in a directory, you navigate to that directory and start autorunner as:</p>

<p><code>~/src/sdq/ocr$ ./autorun.py &quot;python Test*.py&quot;</code></p>

<p>That would start <code>autorun.py</code> and every time I modify a file in the present directory the command  <code>python Test*.py</code> is executed. In my case, I am using the unittest framework that comes with Python. So everytime, a file is updates, it runs all my unit tests, as seen below:</p>

<pre><code class="language-bash">sadiquea@sadiquea-laptop:~/src/sdq/ocr$ ./autorun.py &quot;python Test*.py&quot;
Autorunner in action
.............

----------------------------------------------------------------------

Ran 13 tests in 0.763s

OK
</code></pre>

<p>If I were working with Ruby and wanted to run all my unit tests when I modify the files, I could start the tool like this: <code>./autorun.py &quot;rake spec&quot;</code></p>

<p>I would really like to add the ability to exclude some files/subdirectories from being watched for changes.</p>

<p>Here is the code snippet that does the trick:</p>

<pre><code class="language-python">#!/usr/bin/env python

import sys
import os
import pyinotify

if len(sys.argv)==1:
    print &quot;Please pass a command to excute as a parameter&quot;
    print &quot;For example autorun.py 'ruby foo.rb'&quot;
    sys.exit()

commandToRun = sys.argv[1]

watchManager = pyinotify.WatchManager()
mask = pyinotify.IN_MODIFY

class ActionProcesser(pyinotify.ProcessEvent):
    def process_IN_MODIFY(self, event):
        print &quot;Autorunner in action&quot;
        os.system(commandToRun)

notifier = pyinotify.Notifier(watchManager, ActionProcesser())

wdd = watchManager.add_watch(os.getcwd(), mask, rec=True)

while True:
    try:
        notifier.process_events()
        if notifier.check_events():
            notifier.read_events()
    except KeyboardInterrupt:
        notifier.stop()
        break

</code></pre>

</div>
</div>

  </body>
</html>
