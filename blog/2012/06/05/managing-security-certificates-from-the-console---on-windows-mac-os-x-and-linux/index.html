<!DOCTYPE html5>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" prefix="og: http://ogp.me/ns#">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Managing security certificates from the console - on Windows, Mac OS X and Linux</title>

    
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="/css/clean-blog.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    
    <link href="/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='/css/fonts.css' rel='stylesheet' type='text/css'>

    
    
    

</head>

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@sdqali">
  <meta name="twitter:creator" content="@sdqali">
  <meta name="twitter:title" content="Managing security certificates from the console - on Windows, Mac OS X and Linux">
  <meta name="twitter:description" content="For me the last two weeks or so have involved a lot of wrestling with SSL certificates. One of the things that took some time to figure out was how to piggy-back on the tools provided by different Operating Systems to manage certificates. We did not want to rewrite NSS. Luckily for us, all the major OSes provide tools to manage certificates from the command line.

">
  <meta name="twitter:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]">

  <meta property="og:title" content="Managing security certificates from the console - on Windows, Mac OS X and Linux" />
  <meta property="og:description" content="For me the last two weeks or so have involved a lot of wrestling with SSL certificates. One of the things that took some time to figure out was how to piggy-back on the tools provided by different Operating Systems to manage certificates. We did not want to rewrite NSS. Luckily for us, all the major OSes provide tools to manage certificates from the command line.

" itemprop="description"/>
  <meta property="og:url" content="http://sdqali.in/blog/2012/06/05/managing-security-certificates-from-the-console---on-windows-mac-os-x-and-linux/" />
  <meta property="og:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]" />
  <body>

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Sadique Ali</a>
    </div>

    
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Home</a> </li>
        <li><a href="/blog/">Blog</a> </li>
        <li><a href="/about">About</a> </li>
        <li><a href="/index.xml">Atom Feed</a> </li>
        <li><a href="https://github.com/sdqali">GitHub</a> </li>
        <li><a href="https://twitter.com/sdqali">Twitter</a> </li>
        <li><a href="https://www.linkedin.com/in/sdqali">LinkedIn</a> </li>
      </ul>
    </div>
    
  </div>
  
</nav>




    
    
    <header class="intro-header">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="site-heading">
              <h1> Managing security certificates from the console - on Windows, Mac OS X and Linux</h1>
              <span class="meta">Tue, Jun 5, 2012</span>
            </div>
          </div>
        </div>
      </div>
    </header>


    
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <p>For me the last two weeks or so have involved a lot of wrestling with SSL certificates. One of the things that took some time to figure out was how to piggy-back on the tools provided by different Operating Systems to manage certificates. We did not want to rewrite <a href="https://www.mozilla.org/projects/security/pki/nss/" title="NSS">NSS</a>. Luckily for us, all the major OSes provide tools to manage certificates from the command line.</p>

<p></p>

<h2 id="windows">Windows</h2>

<hr />

<p>Windows provides two ways to deal with certificates from the command line - <a href="http://technet.microsoft.com/en-us/library/cc732443%28WS.10%29.aspx" title="Certutil">Certutil</a> and <a href="http://msdn.microsoft.com/en-us/library/e78byta0.aspx" title="certmgr.exe">certmgr.exe</a>. We decided to go with Certutil because it is present out of the box on Windows 7 and Windows Server 2008, while certmgr.exe is part of the .Net runtime. This blog post will deal with Certutil.</p>

<h3 id="adding-a-certificate">Adding a certificate</h3>

<p>{% codeblock lang:bash %}certutil.exe -addstore -user root foo.crt{% endcodeblock %}</p>

<p>This will install the <code>foo.crt</code> certificate to the Trusted Root Certification Authorities store for the current user.</p>

<h3 id="view-certificates-in-a-store">View certificates in a store</h3>

<p>{% codeblock lang:bash %}certutil.exe -viewstore -user root{% endcodeblock %}</p>

<p>This will list all the certificates in the Trusted Root Certification Authorities store for the current user. One drawback is that it throws up a Window to list as opposed to using STDOUT for output.</p>

<h3 id="list-certificates-in-a-store">List certificates in a store</h3>

<p>{% codeblock lang:bash %}certutil.exe -user -store root{% endcodeblock %}</p>

<p>This will list all the certificates in the Trusted Root Certification Authorities store for the current user to STDOUT.</p>

<p>There are more detailed explanations <a href="http://technet.microsoft.com/en-us/library/cc772898(WS.10).aspx">here</a>.</p>

<h2 id="mac-os-x">Mac OS X</h2>

<hr />

<p>Mac OS X ships the <a href="https://developer.apple.com/library/mac/#documentation/Darwin/Reference/Manpages/man1/security.1.html">security</a> tool to let the user manage certificates and keychains.</p>

<h3 id="adding-a-certificate-1">Adding a certificate</h3>

<p>{% codeblock lang:bash %}security add-certificate foo.crt
security add-trusted-cert foo.crt{% endcodeblock %}</p>

<p>The first line will add <code>foo.crt</code> to the current user&rsquo;s keychain, while the second line ensures that the newly added certificate is trusted. This would mean that the certificate will be trusted for SSL, EAP and Code Signing. To get more fine grained control over what to trust the certificate for, the <code>-p (policy)</code> flag can be used.
{% codeblock lang:bash %}security add-trusted-cert -p ssl foo.crt{% endcodeblock %}</p>

<p>This will trust the certificate only for SSL interactions.</p>

<h3 id="listing-certificates">Listing certificates</h3>

<p>{% codeblock lang:bash %}security find-certificates -a -e foo@bar.com{% endcodeblock %}</p>

<p>This would list all the certificates where e-mail address of the issuer <code>foo@bar.com</code>. Other fields that can be used for matching include <code>-c (name)</code>.</p>

<h2 id="linux">Linux</h2>

<hr />

<p>On Linux, the best we could find was <a href="http://www.mozilla.org/projects/security/pki/nss/tools/certutil.html certutil">certutil</a> which is part of Mozilla&rsquo;s NSS project.</p>

<h3 id="adding-a-certificate-2">Adding a certificate</h3>

<p>{% codeblock lang:bash %}certutil -A -d sql:~/.pki/nssdb -t C -n &ldquo;Certificate Common Name&rdquo; -i foo.crt{% endcodeblock %}</p>

<p>This will add <code>foo.crt</code> to the certificate database <code>~/.pki/nssdb</code>. This is where applications like Chromium look for certificates.</p>

<h3 id="listing-certificates-1">Listing certificates</h3>

<p>{% codeblock lang:bash %}certutil -L -d sql:~/.pki/nssdb -n &ldquo;Certificate Common Name&rdquo;{% endcodeblock %}</p>

<p>This will list the certificates in the <code>~/.pki/nssdb</code> with the common name &ldquo;Certificate Common Name&rdquo;.</p>

<h2 id="firefox">Firefox</h2>

<hr />

<p>While the above steps work fine for pretty much all applications on the three OSes, Firefox does things in it&rsquo;s own way. Firefox implements <a href="https://www.mozilla.org/projects/security/pki/nss/ NSS">NSS</a> and hence does not look at the certificates the OS knows about. One solution to manage certificates from the command line will be to install certutil and point it at the <code>cert.db</code> certificate database in your Firefox profile directory. Alternatively, one could do the following</p>

<ol>
<li>Launch Firefox with a blank profile</li>
<li>Accept the certificates we are interested in.</li>
<li>Save a copy of the <code>cert8.db</code> file.</li>
<li>Import this database to the profiles we wish to run Firefox on.</li>
</ol>

<p>While copying the database is not as clean a solution as using certutil, we decided to go with the second option because there is no guarantee that certutil will be present on the user&rsquo;s box, especially if they are running Windows or Mac OS X. And we had a fairly high control over the Firefox profiles.</p>
            <p class="comments">
  If you have questions or comments about this blog post, you can get in touch with me on Twitter <a href="https://twitter.com/sdqali">@sdqali</a>.
</p>

          </div>
        </div>
      </div>
    </article>

    <hr>

    
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          <li>
            <a href="https://twitter.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://github.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="/index.xml">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        </ul>
        <p class="copyright text-muted">&copy; All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


<script src="/js/jquery.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script src="/js/clean-blog.min.js"></script>

<script src="http://sdqali.in/js/keen.min.3.3.0.js" type="text/javascript"></script>
<script src="http://sdqali.in/js/parseuri.js" type="text/javascript"></script>
<script src="http://sdqali.in/js/ua-parser.min.js" type="text/javascript
"></script>
 <script src="http://sdqali.in/js/Math.uuid.js" type="text/javascript"></script>
<script src="http://sdqali.in/js/analytics.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-86967633-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>
</html>
