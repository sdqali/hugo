<!DOCTYPE html5>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" prefix="og: http://ogp.me/ns#">
  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Importing the Yelp dataset into MongoDB</title>

    
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="/css/clean-blog.min.css" rel="stylesheet">
    <link href="/css/custom.css" rel="stylesheet">

    
    <link href="/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='/css/fonts.css' rel='stylesheet' type='text/css'>

    
    
    

</head>

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@sdqali">
  <meta name="twitter:creator" content="@sdqali">
  <meta name="twitter:title" content="Importing the Yelp dataset into MongoDB">
  <meta name="twitter:description" content="Today Yelp announced their dataset challenge 1. The dataset they released includes data from 5 cities (Phoenix, Las Vegas, Madison, Waterloo and Edinburgh) and consists of
 42,153 businesses 320,002 business attributes 31,617 check-in sets 252,898 users 955,999 edge social graph 403,210 tips 1,125,458 reviews  The data is available for public consumption, although Yelp owns any derivative dataset you create from the original 2.
The data is available as files with each line representing a JSON object.">
  <meta name="twitter:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]">

  <meta property="og:title" content="Importing the Yelp dataset into MongoDB" />
  <meta property="og:description" content="Today Yelp announced their dataset challenge 1. The dataset they released includes data from 5 cities (Phoenix, Las Vegas, Madison, Waterloo and Edinburgh) and consists of
 42,153 businesses 320,002 business attributes 31,617 check-in sets 252,898 users 955,999 edge social graph 403,210 tips 1,125,458 reviews  The data is available for public consumption, although Yelp owns any derivative dataset you create from the original 2.
The data is available as files with each line representing a JSON object." itemprop="description"/>
  <meta property="og:url" content="http://sdqali.in/blog/2014/08/02/importing-the-yelp-dataset-into-mongodb/" />
  <meta property="og:image" content="http://sdqali.in/map[feature:/images/threaded-blue-on-black-cropped.jpg]" />
  <body>

    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Sadique Ali</a>
    </div>

    
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Home</a> </li>
        <li><a href="/blog/">Blog</a> </li>
        <li><a href="/about">About</a> </li>
        <li><a href="/index.xml">Atom Feed</a> </li>
        <li><a href="https://github.com/sdqali">GitHub</a> </li>
        <li><a href="https://twitter.com/sdqali">Twitter</a> </li>
        <li><a href="https://www.linkedin.com/in/sdqali">LinkedIn</a> </li>
      </ul>
    </div>
    
  </div>
  
</nav>




    
    
    <header class="intro-header">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="site-heading">
              <h1> Importing the Yelp dataset into MongoDB</h1>
              <span class="meta">Sat, Aug 2, 2014</span>
            </div>
          </div>
        </div>
      </div>
    </header>


    
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <p>Today Yelp announced their dataset challenge <sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>. The dataset they released includes data from 5 cities (Phoenix, Las Vegas, Madison, Waterloo and Edinburgh) and consists of</p>

<ul>
<li>42,153 businesses</li>
<li>320,002 business attributes</li>
<li>31,617 check-in sets</li>
<li>252,898 users</li>
<li>955,999 edge social graph</li>
<li>403,210 tips</li>
<li>1,125,458 reviews</li>
</ul>

<p>The data is available for public consumption, although Yelp owns any derivative dataset you create from the original <sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup>.</p>

<p>The data is available as files with each line representing a JSON object. Since I am using MongoDB these days to analyze geospatial data, I wanted to convert this into an easy format that I could import into Mongo. Mongo puts a strict constraint on how a location needs to be specified - It expects a location field in a document to be an array in the format <code>[longitude, latitude]</code>.</p>

<p>With this in mind, the first step is to convert and transform the objects into objects that Mongo can make sense of. The following Ruby script does the job:</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span><span style="color: #0099FF; font-style: italic">#!/usr/bin/env ruby</span>

<span style="color: #336666">require</span> <span style="color: #CC3300">&quot;json&quot;</span>

businesses <span style="color: #555555">=</span> <span style="color: #336600">IO</span><span style="color: #555555">.</span>readlines(<span style="color: #CC3300">&quot;yelp.business.json&quot;</span>)<span style="color: #555555">.</span>map <span style="color: #006699; font-weight: bold">do</span> <span style="color: #555555">|</span>line<span style="color: #555555">|</span>
  b <span style="color: #555555">=</span> <span style="color: #336600">JSON</span><span style="color: #555555">.</span>parse(line)
  b<span style="color: #555555">[</span><span style="color: #CC3300">&quot;location&quot;</span><span style="color: #555555">]</span> <span style="color: #555555">=</span> {
    <span style="color: #CC3300">&quot;type&quot;</span> <span style="color: #555555">=&gt;</span> <span style="color: #CC3300">&quot;Point&quot;</span>,
    <span style="color: #CC3300">&quot;coordinates&quot;</span> <span style="color: #555555">=&gt;</span> <span style="color: #555555">[</span>b<span style="color: #555555">[</span><span style="color: #CC3300">&quot;longitude&quot;</span><span style="color: #555555">]</span>, b<span style="color: #555555">[</span><span style="color: #CC3300">&quot;latitude&quot;</span><span style="color: #555555">]]</span>
  }
  b
<span style="color: #006699; font-weight: bold">end</span>
<span style="color: #336600">IO</span><span style="color: #555555">.</span>write <span style="color: #CC3300">&quot;businesses.mongo.json&quot;</span>, businesses<span style="color: #555555">.</span>to_json
</pre></div>

<p>The next step is to import this data into Mongo using the <code>mongoimport</code> tool.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>mongoimport --collection businesses --file businesses.mongo.json --jsonArray
</pre></div>

<p>We need the <code>--jsonArray</code> parameter because our data is an array.</p>

<p>Since there are 42153 businesses, it will take some time. On my Macbook Pro, it took around 2 minutes, 10 seconds. Once the import is done, make sure that we have a Geospatial index on the <code>location</code> field.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>db.businesses.ensureIndex({location<span style="color: #555555">:</span> <span style="color: #CC3300">&quot;2dsphere&quot;</span>})
</pre></div>

<p>Once the indexing is done, we can use Mongo&rsquo;s Geospatial queries to find interesting things. As an example, here we look up all the restaurants within 1 kilometer distance from downtown Phoenix.</p>
<div class="highlight" style="background: #f0f3f3"><pre style="line-height: 125%"><span></span>db.businesses.find({
  location<span style="color: #555555">:</span> {
    $near<span style="color: #555555">:</span> {
      $geometry<span style="color: #555555">:</span> {
	type<span style="color: #555555">:</span> <span style="color: #CC3300">&quot;Point&quot;</span>,
	coordinates<span style="color: #555555">:</span> [<span style="color: #555555">-</span><span style="color: #FF6600">112.0667</span>, <span style="color: #FF6600">33.4500</span>]
      },
      $maxDistance<span style="color: #555555">:</span> <span style="color: #FF6600">1000</span>
    }
  }
})
</pre></div>

<p>Happy hacking.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"><a href="http://www.yelp.com/dataset_challenge">Yelp Dataset Challenge, 2014</a>.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">DATASET CHALLENGE ACADEMIC DATASET TERMS OF USE <a href="https://www.yelp.com/html/pdf/Dataset_Challenge_Academic_Dataset_Agreement.pdf">Section 5, Ownership</a>.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>

            <p class="comments">
  If you have questions or comments about this blog post, you can get in touch with me on Twitter <a href="https://twitter.com/sdqali">@sdqali</a>.
</p>

          </div>
        </div>
      </div>
    </article>

    <hr>

    
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          <li>
            <a href="https://twitter.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="https://github.com/sdqali">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          <li>
            <a href="/index.xml">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
        </ul>
        <p class="copyright text-muted">&copy; All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


<script src="/js/jquery.js"></script>


<script src="/js/bootstrap.min.js"></script>


<script src="/js/clean-blog.min.js"></script>

<script src="/js/keen.min.3.3.0.js" type="text/javascript"></script>
<script src="/js/parseuri.js" type="text/javascript"></script>
<script src="/js/ua-parser.min.js" type="text/javascript
"></script>
 <script src="/js/Math.uuid.js" type="text/javascript"></script>
<script src="/js/analytics.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');

</script>


  </body>
</html>
